<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
    ﻿html,body,div,form,fieldset,legend,label,h1{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0}th,td{text-align:left;vertical-align:top}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:normal}img{border:0;max-width:100%}h1{font-size:1.87em}h2{font-size:1.2em;margin-bottom:10px;margin-top:0}h3{margin-top:50px}body{background-color:#fff;color:rgba(0,0,0,.8);font-family:medium-content-serif-font,Georgia,Cambria,"Times New Roman",Times,serif;-moz-font-feature-settings:"liga" on;font-feature-settings:"liga" on;font-size:1.25em;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;letter-spacing:-0.003em;line-height:1.58;text-rendering:optimizeLegibility}article{margin-top:44px}pre{-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:.92em;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;padding:20px;overflow:auto}::-moz-selection{background:#000;color:#fff}::selection{background:#000;color:#fff}body{margin-top:8%}header{font-size:.78em;margin:0 auto 2em;max-width:220px;text-align:center}a:link,a:visited,a:hover,a:active{color:#af403c;text-decoration:none}a:hover{text-decoration:underline}nav{text-align:center}nav ul{display:inline-block;text-align:initial;padding-left:0}nav li:not(:first-child):before{content:" · "}nav li{list-style:none;display:inline}.logo{background-size:cover;display:inline-block;height:150px;width:171px}.published-date{color:#888;font-size:.8em}blockquote{border-left:4px solid #ededee;font-style:italic;margin:4px 10px;padding:3px 20px}code{background-color:#f9f9fa;border:1px solid #ededee;border-radius:6px;display:inline-block;font-family:"Courier New","Courier",monospace;-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:16px;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;max-width:100%;overflow-x:auto;padding:0 5px;vertical-align:middle;word-wrap:normal;box-shadow:0 1px 1px rgba(0,0,0,.125)}.button{background-color:#af403c;border-radius:10px;color:#fff;margin:40px auto;padding:10px;text-align:center}.button:hover{background-color:red}.talk{margin-top:80px}.video-container{position:relative;padding-bottom:56.25%;padding-top:30px;height:0;overflow:hidden;margin-bottom:40px}.video-container iframe,.video-container object,.video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}figure{font-size:.9em;font-style:italic;margin:0 0 40px;padding:0;text-align:center;text-indent:0}figcaption{margin-top:10px}.loader{position:relative;overflow:hidden;width:auto}.loader object{position:absolute}.loader img,.loader object{display:block;top:0;left:0;width:100%}object{position:relative;float:left;display:block}object::after{position:absolute;top:0;left:0;display:block;width:1000px;height:1000px;content:"";background:#efefef}.frozen{-webkit-filter:blur(8px);-moz-filter:blur(8px);-o-filter:blur(8px);-ms-filter:blur(8px);filter:blur(8px);transform:scale(1.04);animation:.2s ease-in .4s 1 forwards fade;width:100%}@keyframes fade{0%{opacity:1}100%{opacity:0}}@media(max-width: 520px){body{padding:0 20px}pre{font-size:.85em;padding:5px}h1{font-size:1.6em}}@media(min-width: 520px){body{margin:10% auto 0;margin-top:120px;width:480px}h1{font-size:1.6em}}@media(min-width: 1024px){body{width:850px}header{float:left;width:210px}main,footer{margin-left:260px;margin-bottom:40px}}footer{margin-bottom:40px}.links{list-style:none;display:inline}.field{padding:10px;font-size:.8em}.email{width:300px}.submit{border:none;padding:12px;background-color:#eee}

    </style>
    <link rel="dns-prefetch" href="//www.google-analytics.com/" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=m2llJQPQq8">
    <link rel="manifest" href='data:application/manifest+json,
    { "short_name": "Endler",
    "icons": [
        {
            "src": "/android-chrome-192x192.png?v=m2llJQPQq8",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "/android-chrome-512x512.png?v=m2llJQPQq8",
            "sizes": "512x512",
            "type": "image/png"
        }
    ]
    }' />
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=m2llJQPQq8" color="#5bbad5">
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">


<meta property="og:title" content="A Tiny `ls` Clone Written in Rust" />
<meta property="og:type" content="website" />
<meta property="og:description" content="In my series of useless..." />
<meta property="og:url" content="https://matthias-endler.de/2018/ls" />
<meta property="og:image" content="https://matthias-endler.de/img/social/default.png" />

<meta name="twitter:title" content="A Tiny `ls` Clone Written in Rust">
<meta name="twitter:description" content="In my series of useless...">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://matthias-endler.de/img/social/default.png">

    
      
        <title>A Tiny `ls` Clone Written in Rust | Matthias Endler</title>
      

    <meta name="author" content="Matthias Endler">
    <meta name="description" content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and backend development. PHP, Python, Go, Rust."/>
  </head>
  <body>
        <header>
            <a class="logo" href="/"><img alt="Home" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3OTAuMjMgNjkyLjYxIj48Y2lyY2xlIGN4PSI0MTMuMjQiIGN5PSIyMjcuNyIgcj0iMjE5LjY4IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTYuMDMiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCIvPjxnIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjYTE2MjAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCI+PHBhdGggZmlsbD0iIzMzMWYwMCIgc3Ryb2tlLXdpZHRoPSIxLjk3IiBkPSJNNDgzLjc1IDI2NS43NGwtNjcuMDcgNDAuMTQtNzQuMjMtMzkuNTMgMTQxLjMtLjZ6IiBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JSIvPjxwYXRoIGZpbGw9IiNlZmJhMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQ4Ni42NSAyNjUuOTJsLTcwLjIgMzQuMDItNzYuOS0zMy45IDE0Ny4xLS4xMnoiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIi8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2OC42NCAyLjkxNCkgc2NhbGUoLjY1Nzk1KSIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIj48ZWxsaXBzZSBjeD0iLTYwOC43NSIgY3k9Ii0xNjMuMTQiIHRyYW5zZm9ybT0ibWF0cml4KDEuMjQ4OTcgLS4xMTM3IC4xMDcgMS4xNzUxNyAxMDk1Ljg3IDQ2Ni43KSIgcng9IjI1LjI1IiByeT0iMjgiLz48ZWxsaXBzZSBjeD0iMzMxLjM2IiBjeT0iMzQ3Ljk5IiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09Im1hdHJpeCguNTIyMTMgMCAwIC41NDc0NSAxNTguNzU3IDEzNi40MzIpIiByeD0iMTUuMTUiIHJ5PSIxNy4wNCIvPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjguNjQgMi45MTQpIHNjYWxlKC42NTc5NSkiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCI+PGVsbGlwc2UgY3g9Ii02MDguNzUiIGN5PSItMTYzLjE0IiB0cmFuc2Zvcm09Im1hdHJpeCgxLjI0ODk3IC0uMTEzNyAuMTA3IDEuMTc1MTcgMTIwMy4yIDQ2Ny42NDYpIiByeD0iMjUuMjUiIHJ5PSIyOCIvPjxlbGxpcHNlIGN4PSIzMzEuMzYiIGN5PSIzNDcuOTkiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0ibWF0cml4KC41MjIxMyAwIDAgLjU0NzQ1IDI2NS4zNTggMTM2Ljk5MykiIHJ4PSIxNS4xNSIgcnk9IjE3LjA0Ii8+PC9nPjxnIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjMDAwIj48cGF0aCBkPSJNMzY2LjQgMTAwLjY0YzE4LjU0LTExLjA1IDM2LjU0LTIyLjU3IDQ2Ljk0LTQwLjczIDEuMzUgMTIuMy0uMSAyOC41LTEwLjg2IDQzLjUiLz48cGF0aCBkPSJNMzg5LjQ0IDEwMC42NGMxOC41NC0xMS4wNSAzNi41NC0yMi41NyA0Ni45NC00MC43MyAxLjM1IDEyLjMtLjEgMjguNS0xMC44NiA0My41Ii8+PHBhdGggZD0iTTQxMi40OCAxMDAuNjRDNDMxLjAyIDg5LjYgNDQ5IDc4LjA3IDQ1OS40MiA1OS45YzEuMzUgMTIuMy0uMSAyOC40NC0xMC44NiA0My40NiIvPjwvZz48cGF0aCBkPSJNNDA5LjI0IDg3LjA1Yy04MS44NS4yNy0xNTYuNDQgMTA0LjQzLTE4MC40OCAyMTYuNDZhMTk5LjYgMTk5LjYgMCAwIDAgNTEuODMgNzMuMWM3LjktMTU3LjkgNDQuNy0yNjYuOSAxMTIuNS0yMDcuOCAxMC4xIDguOSAxNS4yIDEyLjkgMjAuMSAxMi42IDQuOS4zIDEwLTMuOCAyMC4xLTEyLjYgNjcuNy01OS4xIDEwNC42IDUwIDExMi41IDIwNy44YTE5OS42IDE5OS42IDAgMCAwIDUxLjgtNzIuOWMtMjQtMTEyLTk4LjYtMjE2LjMtMTgwLjUtMjE2LjUtMS4zOCAwLTIuNy4xLTQgLjEtMS4zOCAwLTIuNy0uMS00LS4xeiIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZmlsbD0iIzk1OTU5NSIgZD0iTTEzMS4zIDY5Mi42aDExLjRsLTIwLjkyLTEzOC4zSDEwOS41TDg4LjYgNjkyLjZIMTAwbDUuODgtNDUuOGgxOS4zNnptLTI0LjItNTQuOTZsOC40Ni02NC4zIDguNDcgNjQuM3ptODIuMDUtODMuMzRIMTQ4djEwLjczaDE0Ljg3VjY5Mi42aDExLjRWNTY1LjA0aDE0Ljg4eiIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBmb250LWZhbWlseT0iRXZlciBBZnRlciIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCIvPjxwYXRoIGZpbGw9IiM5NTk1OTUiIGQ9Ik0yMjguNjUgNTU0LjNIMTg3LjV2MTAuNzNoMTQuODdWNjkyLjZoMTEuNFY1NjUuMDRoMTQuODh6bTQ0LjkgMHY2MS4zOEgyNDUuMlY1NTQuM2gtMTEuNDJ2MTM4LjNoMTEuNHYtNjYuMzhoMjguMzZ2NjYuNGgxMS4yM1Y1NTQuM3ptMzcuOCAxMzguM2gtMTEuNFY1NTQuM2gxMS40em01Ny42NSAwaDExLjRsLTIwLjkyLTEzOC4zSDM0Ny4ybC0yMC45IDEzOC4zaDExLjRsNS44Ny00NS44aDE5LjM2em0tMjQuMjItNTQuOTZsOC40Ny02NC4zIDguNDcgNjQuM3oiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246J0V2ZXIgQWZ0ZXIsIE5vcm1hbCc7dGV4dC1hbGlnbjpzdGFydCIgZm9udC1mYW1pbHk9IkV2ZXIgQWZ0ZXIiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiLz48cGF0aCBkPSJNNTE3LjI2IDU2NS4wM1Y1NTQuM2gtMzEuNjR2MTM4LjNoMzEuNjR2LTEwLjdoLTIwLjIzdi01NS43aDE4Ljg1di0xMC41NGgtMTguODVWNTY1em0xMS4yNC0xMC43M3YxMzguM2gxMS4zNVY1NTQuM0g1MjguNXptMzkuNzYgMHY1MS44N2wtLjEtLjE3djIwLjc1bC4xLjE3djY1LjdoMTEuMjRWNTU0LjNoLTExLjI0em00MC4yNCAwaC0xMy44djEzOC4zaDEzLjgzcTIyLjMgMCAyOS41Ny0yMi40NiA0LjE1LTEzLjMyIDQuMTUtNDYuNjh0LTQuMTUtNDYuNjdxLTcuMjYtMjIuNS0yOS41Ni0yMi41em0tMS4yIDEyNy42aC0xLjJWNTY1LjAyaDEuMnExNS43MyAwIDIwLjU3IDE4LjUgMy4xIDExLjA2IDMuMSAzOS45MyAwIDI4Ljg3LTMuMSAzOS45My00Ljg0IDE4LjUtMjAuNTcgMTguNXptNjAuMjQgMFY1NTQuM2gtMTEuNHYxMzguM2gzMS42MnYtMTAuN3ptNjIuMS0xMTYuODdWNTU0LjNINjk4djEzOC4zaDMxLjYzdi0xMC43SDcwOS40di01NS43aDE4Ljg1di0xMC41NEg3MDkuNFY1NjV6bTYwLjUgMTI3LjU3cS0xNC4xNy0zNy0yMC43NC03Mi4yNSAxNC4xNy0xMC4zNyAxNC4xNy0zMy44OCAwLTMyLjE2LTI3LjQ4LTMyLjE2aC0xNS4zdjEzOC4zaDExLjR2LTY1cTIuMi0uNSA2LjktMiA3IDMzLjQgMTguMyA2Ny4xem0tMzcuODYtNzguNDd2LTQ5LjFoMi42cTEwLjU0IDAgMTQuNyA1Ljg4IDMuMjcgNC43IDMuMjcgMTUuNiAwIDE1LjgtOC4xMiAyMy40LTUuMiA0LjktMTAuMiA0LjktMS4zOCAwLTIuMjUtLjV6IiBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOidFdmVyIEFmdGVyLCBOb3JtYWwnO3RleHQtYWxpZ246c3RhcnQiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEwIiBkPSJNNTM1LjA2IDU1NS43MmwzOCAxMzUuNTQiLz48cGF0aCBmaWxsPSIjOTU5NTk1IiBkPSJNLjEgNTU0LjZ2MTM4aDExLjM4VjU3NS42NWM2LjYgMTIuNyAxMy43OCAyNS45IDE5LjY3IDM2Ljc4bDUuNyAxMCAuMDItLjAydi4xbDUuNzItMTBjNi41LTEyIDEzLjUtMjUuMiAxOS43LTM2Ljh2MTE2LjloMTEuMnYtMTM4SDYyLjNDNTUgNTY4IDQ3LjUgNTgyIDQwLjggNTk0LjRsLTQgNy40NWMtOS4xLTE3LjA1LTE3LjMtMzIuMDctMjUuNC00Ny4yM3oiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246J0V2ZXIgQWZ0ZXIsIE5vcm1hbCc7dGV4dC1hbGlnbjpzdGFydCIgZm9udC1zaXplPSIxNzIuNTIiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZmlsbD0iIzk1OTU5NSIgZD0iTTM5OC44NCA2OTEuNjZjLTMuNzItMS4zMy04Ljk2LTUtMTEuNzYtOC4yLTEuNC0xLjYtMi41LTMuMjUtMi41NC0zLjYgNC4yMy02LjA1IDQuNDItNi4zMiA1LjMtNy40NSAzLjMgMy40IDYuNyA2LjggMTAuOSA5LjEgNC45OCAxLjggMTEuMjQgMi4xIDE1LjMyLS4zIDUuNTItMy4zIDguNjItOC44IDkuNjctMTcuMyAxLjQ2LTExLjctMi42NS0yMi41LTEzLjI1LTM0LjgtMi45LTMuNC03LjEzLTguMy05LjM4LTEwLjktNC44Ni01LjYtMTAtMTMuNC0xMS43Ny0xOC41LTQuMy0xMi41LTMuODctMjEuMy0uNjYtMzAuMiAyLjEyLTUuODMgNC45LTkuNiA5LjA4LTEyLjIgOC4yNi01LjE0IDE5LjI4LTQuMjQgMjcuMzYgMi4yNS45LjY4IDEuNyAxLjQ0IDIuNSAyLjU3LS40Ljc3LTMuNyA4Ljc3LTQuMyA4Ljc3LS44LS42Ni0uOC0uNi0xLjYtMS4zLS43LS43LTIuNy0yLjEtNC40LTMuMTQtNC40LTIuMS04LjUtMy4xLTEyLjktLjctNi4xIDMuNDQtOS4yIDExLjctNy45IDIxLjQgMS4xIDguMzQgNC41IDE0IDE3LjkgMjkuNSAxMy4wOCAxNS4yIDE2Ljk1IDIyLjMgMTguOSAzNC42My45IDUuNy45IDEwLjA0IDAgMTYuNi0xLjY1IDEyLjMzLTcuMiAyMC41LTE2LjIgMjMuOTYtMy4zIDEuMy0xNi40NSAxLjMtMjAuMDMuMDR6Ii8+PC9zdmc+" />
            </a>
            <p>
              Backend Engineer at trivago. Likes just-in-time compilers and hot chocolate. <a href="/about">About me.</a>
            </p>
            <nav>
              <ul>
                <li><a href="/">Home</a></li>
                <li><a target="_blank" rel="noopener" href="https://twitter.com/matthiasendler">Twitter</a></li>
                <li><a target="_blank" rel="noopener" href="https://feedly.com/i/subscription/feed/https://matthias-endler.de/rss.xml">RSS</a></li>
              </ul>
            </nav>
        </header>
        <main role="main">
            
              <div class="published-date">
                <i>Published on 9th of March 2018</i>
              </div>
            
              <h1>A Tiny `ls` Clone Written in Rust</h1>
            <p>In my series of <a href="/2017/yes/">useless Unix tools rewritten in Rust</a>, today I'm going to be covering one of my all-time favorites: <code>ls</code>.</p>
<p>First off, let me say that you probably don't want to use this code as a replacement for <code>ls</code> on your local machine (although you could!).
As we will find out, <code>ls</code> is actually quite a powerful tool under the hood.
I'm not going to come up with a full rewrite, but instead only cover the very basic output that you would expect from calling <code>ls -l</code> on your command line.
What is this output? I'm glad you asked.</p>
<h3>Expected output</h3>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">&gt; ls -l
</span><span style="background-color:#eff1f5;color:#4f5b66;">drwxr-xr-x 2 mendler  staff    13468 Feb  4 11:19 Top Secret
</span><span style="background-color:#eff1f5;color:#4f5b66;">-rwxr--r-- 1 mendler  staff  6323935 Mar  8 21:56 Never Gonna Give You Up - Rick Astley.mp3
</span><span style="background-color:#eff1f5;color:#4f5b66;">-rw-r--r-- 1 mendler  staff        0 Feb 18 23:55 Thoughts on Chess Boxing.doc
</span><span style="background-color:#eff1f5;color:#4f5b66;">-rw-r--r-- 1 mendler  staff   380434 Dec 24 16:00 nobel-prize-speech.txt
</span></pre>
<p>Your output may vary, but generally, there are a couple of notable things going on. From left to right, we've got the following fields:</p>
<ul>
<li>The <code>drwx</code> things in the beginning are the <em>file permissions</em> (also called the file mode). If <code>d</code> is set, it's a directory. <code>r</code> means read, <code>w</code> means write and <code>x</code> execute.
This <code>rwx</code> pattern gets repeated three times for the current user, the group, and other computer users respectively.</li>
<li>Next we got the hardlink count when referring to a file, or the number of contained directory entries when referring to a directory. (<a target="_blank" rel="noopener" href="https://unix.stackexchange.com/a/43047">Reference</a>)</li>
<li>Owner name</li>
<li>Group name</li>
<li>Number of bytes in the file</li>
<li>Date when the file was last modified</li>
<li>Finally, the path name</li>
</ul>
<p>For more in-depth information, I can recommend reading the manpage of <code>ls</code> from the <a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man1/ls.1.html">GNU coreutils</a> used in most Linux distributions and the one from <a target="_blank" rel="noopener" href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/ls.1.html">Darwin</a> (which powers MacOS).</p>
<p>Whew, that's a lot of information for such a tiny tool.
But then again, it can't be so hard to port that to Rust, right? Let's get started!</p>
<h3>A very basic <code>ls</code> in Rust</h3>
<p>Here is the most bare-bones version of <code>ls</code>, which just prints all files in the current directory:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">fs</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">path::</span><span style="background-color:#eff1f5;color:#4f5b66;">Path</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">error::</span><span style="background-color:#eff1f5;color:#4f5b66;">Error</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">process</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">if</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Err</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#b48ead;">ref</span><span style="background-color:#eff1f5;color:#4f5b66;"> e</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">run</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Path::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">.</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> e</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">process::</span><span style="background-color:#eff1f5;color:#4f5b66;">exit</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">run</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">dir</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">Path</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Result</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Error</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">if</span><span style="background-color:#eff1f5;color:#4f5b66;"> dir.</span><span style="background-color:#eff1f5;color:#96b5b4;">is_dir</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#b48ead;">for</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry </span><span style="background-color:#eff1f5;color:#4f5b66;">in</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">fs::</span><span style="background-color:#eff1f5;color:#4f5b66;">read_dir</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">dir</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> file_name </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry
</span><span style="background-color:#eff1f5;color:#4f5b66;">                        </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">file_name</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                        </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">into_string</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                        </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">or_else</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#bf616a;">f</span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Err</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">format!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">Invalid entry: </span><span style="background-color:#eff1f5;color:#d08770;">{:?}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> f</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                </span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> file_name</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Ok</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>We can copy that straight out of the <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/fs/fn.read_dir.html#examples">documentation</a>.
When we run it, we get the expected output:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">&gt; cargo run
</span><span style="background-color:#eff1f5;color:#4f5b66;">Cargo.lock
</span><span style="background-color:#eff1f5;color:#4f5b66;">Cargo.toml
</span><span style="background-color:#eff1f5;color:#4f5b66;">src
</span><span style="background-color:#eff1f5;color:#4f5b66;">target
</span></pre>
<p>It prints the files and exits. Simple enough.</p>
<p>We should stop for a moment and celebrate our success, knowing that we just wrote our first little Unix utility from scratch.
<em>Pro Tip</em>: You can install the binary with <code>cargo install</code> and call it like any other binary from now on.</p>
<p>But we have higher goals, so let's continue.</p>
<h3>Adding a parameter to specify the directory</h3>
<p>Usually, if we type <code>ls mydir</code>, we expect to get the file listing of no other directory than <code>mydir</code>. We should add the same functionality to our version.</p>
<p>To do this, we need to accept command line parameters.
One Rust crate that I love to use in this case is <a target="_blank" rel="noopener" href="https://crates.io/crates/structopt">structopt</a>. It makes argument parsing very easy.</p>
<p>Add it to your <code>Cargo.toml</code> either manually or by using <a target="_blank" rel="noopener" href="https://crates.io/crates/cargo-edit">cargo-edit</a>:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">cargo add structopt
</span></pre>
<p>Now we can import it and use it in our project:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#a7adba;">#[macro_use]</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">extern</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">crate</span><span style="background-color:#eff1f5;color:#4f5b66;"> structopt</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#a7adba;">//</span><span style="background-color:#eff1f5;color:#a7adba;"> use std::...
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">structopt::</span><span style="background-color:#eff1f5;color:#4f5b66;">StructOpt</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#a7adba;">#[derive(StructOpt, Debug)]</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Opt</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#a7adba;">///</span><span style="background-color:#eff1f5;color:#a7adba;"> Output file
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">#[structopt(default_value = &quot;.&quot;, parse(from_os_str))]
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">path</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> PathBuf,
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> opt </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Opt::</span><span style="background-color:#eff1f5;color:#4f5b66;">from_args</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">if</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Err</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#b48ead;">ref</span><span style="background-color:#eff1f5;color:#4f5b66;"> e</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">run</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">opt.path</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> e</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">process::</span><span style="background-color:#eff1f5;color:#4f5b66;">exit</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">run</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">dir</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">PathBuf</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Result</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Error</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#a7adba;">//</span><span style="background-color:#eff1f5;color:#a7adba;"> Same as before
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>By adding the <code>Opt</code> struct, we can define the command line flags, input parameters, and the <code>help</code> output super easily.
There are tons of configuration options, so it's worth checking out the <a target="_blank" rel="noopener" href="https://github.com/TeXitoi/structopt">project homepage</a>.</p>
<p>Also note, that we changed the type of the path variable from <code>Path</code> to <code>PathBuf</code>. The difference is, that <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/src/std/path.rs.html#1107-1109"><code>PathBuf</code> owns the inner path string</a>, while <code>Path</code> <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/src/std/path.rs.html#1629-1631">simply provides a reference to it</a>. The relationship is similar to <code>String</code> and <code>&amp;str</code>.</p>
<h3>Reading the modification time</h3>
<p>Now let's deal with the metadata.
First, we try to retrieve the modification time from the file.
A quick look at <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/std/fs/struct.Metadata.html">the documentation</a> shows us how to do it:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">fs</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> metadata </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">fs::</span><span style="background-color:#eff1f5;color:#4f5b66;">metadata</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">foo.txt</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">if</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Ok</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">time</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> metadata.</span><span style="background-color:#eff1f5;color:#96b5b4;">modified</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{:?}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> time</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>The output might not be what you expect: we receive a <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/std/time/struct.SystemTime.html"><code>SystemTime</code></a> object, which represents the measurement of the system clock. E.g. <a target="_blank" rel="noopener" href="https://play.rust-lang.org/?gist=96e18ed541abe896f761d601cdf50561&amp;version=stable">this code</a></p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{:?}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">SystemTime::</span><span style="background-color:#eff1f5;color:#4f5b66;">now</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#a7adba;">//</span><span style="background-color:#eff1f5;color:#a7adba;"> Prints: SystemTime { tv_sec: 1520554933, tv_nsec: 610406401 }
</span></pre>
<p>But the format that we would like to have is something like this:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">Mar  </span><span style="background-color:#eff1f5;color:#d08770;">9</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">01</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#d08770;">24</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Thankfully, there is a library called <code>chrono</code>, which can read this format and <a href="">convert it into any human readable output</a> we like:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> current</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">DateTime</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Local</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">DateTime::</span><span style="background-color:#eff1f5;color:#4f5b66;">from</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">SystemTime::</span><span style="background-color:#eff1f5;color:#4f5b66;">now</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> current.</span><span style="background-color:#eff1f5;color:#96b5b4;">format</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">%_d %b %H:%M</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">to_string</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>this prints</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">9 Mar 01:29
</span></pre>
<p>(Yeah, I know it's getting late.)</p>
<p>Armed with that knowledge, we can now read our file modification time.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">cargo add chrono
</span></pre><pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">chrono::</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">DateTime</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Local</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">run</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">dir</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">PathBuf</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Result</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Error</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">if</span><span style="background-color:#eff1f5;color:#4f5b66;"> dir.</span><span style="background-color:#eff1f5;color:#96b5b4;">is_dir</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#b48ead;">for</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry </span><span style="background-color:#eff1f5;color:#4f5b66;">in</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">fs::</span><span style="background-color:#eff1f5;color:#4f5b66;">read_dir</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">dir</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> file_name </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">...</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> metadata </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry.</span><span style="background-color:#eff1f5;color:#96b5b4;">metadata</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> size </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> metadata.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> modified</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">DateTime</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Local</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">DateTime::</span><span style="background-color:#eff1f5;color:#4f5b66;">from</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">metadata.</span><span style="background-color:#eff1f5;color:#96b5b4;">modified</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{:&gt;5}</span><span style="background-color:#eff1f5;color:#a3be8c;"> </span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#a3be8c;"> </span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                </span><span style="background-color:#eff1f5;color:#4f5b66;">size</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                </span><span style="background-color:#eff1f5;color:#4f5b66;">modified.</span><span style="background-color:#eff1f5;color:#96b5b4;">format</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">%_d %b %H:%M</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">to_string</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                </span><span style="background-color:#eff1f5;color:#4f5b66;">file_name
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Ok</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>This <code>{:&gt;5}</code> might look weird. It's a formatting directive provided by <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/fmt/"><code>std::fmt</code></a>.
It means &quot;right align this field with a space padding of 5&quot; - just like our bigger brother <code>ls -l</code> is doing it.</p>
<p>Similarly, we retrieved the size in bytes with <code>metadata.len()</code>.</p>
<h3>Unix file permissions are a zoo</h3>
<p>Reading the file permissions is a bit more tricky.
While the <code>rwx</code> notation is very common in Unix derivatives such as *BSD or GNU/Linux, many other operating systems ship their own permission management.
There are even <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/File_system_permissions">differences between the Unix derivatives</a>.</p>
<p>Wikipedia lists a few extensions to the file permissions that you might encounter:</p>
<ul>
<li>+ (plus) suffix indicates an <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Access_control_list">access control list</a> that can control additional permissions.</li>
<li>. (dot) suffix indicates an <a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/security-enhanced_linux/chap-security-enhanced_linux-selinux_contexts">SELinux context</a> is present. Details may be listed with the command ls -Z.</li>
<li>@ suffix indicates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Extended_file_attributes">extended file attributes</a> are present.</li>
</ul>
<p>That just goes to show, that there are a lot of important details to be considered when implementing this in real life.</p>
<h3>Implementing very basic file mode</h3>
<p>For now, we just stick to the basics and assume we are on a platform that supports the <code>rwx</code> file mode.</p>
<p>Behind the <code>r</code>, the <code>w</code> and the <code>x</code> are in reality octal numbers. That's easier for computers to work with and many hardcore users even prefer to type the numbers over the symbols.
The ruleset behind those octals is as follows. I took that from the <code>chmod</code> manpage.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Modes may be absolute or symbolic. 
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">An absolute mode is an octal number constructed 
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">from the sum of one or more of the following values
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0400    Allow read by owner.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0200    Allow write by owner.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0100    For files, allow execution by owner.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0040    Allow read by group members.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0020    Allow write by group members.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0010    For files, allow execution by group members.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0004    Allow read by others.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0002    Allow write by others.
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">0001    For files, allow execution by others.
</span></pre>
<p>For example, to set the permissions for a file so that the owner can read, write and execute it and nobody else can do anything would be 700 (400 + 200 +100).</p>
<p>Granted, those numbers are the same since the 70s and are not going to change soon, but it's still a bad idea to compare our file permissions directly with the values; if not for compatibility reasons, then for readability and to avoid magic numbers in our code.</p>
<p>Therefore, we use the <code>libc</code> crate, which provides constants for those magic numbers.
As mentioned above, these file permissions are Unix specific, so we need to import a Unix-only library named <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/os/unix/fs/trait.PermissionsExt.html"><code>std::os::unix::fs::PermissionsExt;</code></a> for that.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">extern</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">crate</span><span style="background-color:#eff1f5;color:#4f5b66;"> libc</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#a7adba;">//</span><span style="background-color:#eff1f5;color:#a7adba;"> Examples:
</span><span style="background-color:#eff1f5;color:#a7adba;">//</span><span style="background-color:#eff1f5;color:#a7adba;"> * `S_IRGRP` stands for &quot;read permission for group&quot;,
</span><span style="background-color:#eff1f5;color:#a7adba;">//</span><span style="background-color:#eff1f5;color:#a7adba;"> * `S_IXUSR` stands for &quot;execution permission for user&quot;
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">libc::</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#d08770;">S_IRGRP</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IROTH</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IRUSR</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IWGRP</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IWOTH</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IWUSR</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IXGRP</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IXOTH</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IXUSR</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">os::</span><span style="background-color:#eff1f5;color:#4f5b66;">unix::</span><span style="background-color:#eff1f5;color:#4f5b66;">fs::</span><span style="background-color:#eff1f5;color:#4f5b66;">PermissionsExt</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>We can now get the file permissions like so:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> metadata </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> entry.</span><span style="background-color:#eff1f5;color:#96b5b4;">metadata</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> mode </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> metadata.</span><span style="background-color:#eff1f5;color:#96b5b4;">permissions</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">mode</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#96b5b4;">parse_permissions</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">mode </span><span style="background-color:#eff1f5;color:#4f5b66;">as</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">u16</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p><code>parse_permissions()</code> is a little helper function defined as follows:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">parse_permissions</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">mode</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">u16</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> String</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> user </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">triplet</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">mode</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IRUSR</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IWUSR</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IXUSR</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> group </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">triplet</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">mode</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IRGRP</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IWGRP</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IXGRP</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> other </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">triplet</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">mode</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IROTH</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IWOTH</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">S_IXOTH</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">user</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> group</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> other</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">join</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>It takes the file mode as a <code>u16</code> (simply because the libc constants are <code>u16</code>)
and calls <code>triplet</code> on it.
For each flag <code>read</code>, <code>write</code>, and <code>execute</code>, it runs a binary <code>&amp;</code> operation on <code>mode</code>.
The output is matched exhaustively against all possible permission patterns.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">triplet</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">mode</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">u16</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#bf616a;">read</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">u16</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#bf616a;">write</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">u16</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#bf616a;">execute</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">u16</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> String</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">match</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">mode </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;"> read</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> mode </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;"> write</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> mode </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;"> execute</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">---</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">r--</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">-w-</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">--x</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">r-x</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">rw-</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">-wx</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">_</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">rwx</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">to_string</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<h3>Wrapping up</h3>
<p>The final output looks like this. Close enough.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">&gt; cargo run
</span><span style="background-color:#eff1f5;color:#4f5b66;">rw-r--r--     7  6 Mar 23:10 .gitignore
</span><span style="background-color:#eff1f5;color:#4f5b66;">rw-r--r-- 15618  8 Mar 00:41 Cargo.lock
</span><span style="background-color:#eff1f5;color:#4f5b66;">rw-r--r--   185  8 Mar 00:41 Cargo.toml
</span><span style="background-color:#eff1f5;color:#4f5b66;">rwxr-xr-x   102  5 Mar 21:31 src
</span><span style="background-color:#eff1f5;color:#4f5b66;">rwxr-xr-x   136  6 Mar 23:07 target
</span></pre>
<p>That's it! You can find the <a target="_blank" rel="noopener" href="https://gist.github.com/mre/91ebb841c34df69671bd117ead621a8b">final version of our toy <code>ls</code> on Github</a>.
We are still far away from a full-fledged <code>ls</code> replacement, but at least we learned a thing or two about its internals.</p>
<p>If you're looking for a proper <code>ls</code> replacement written in Rust, go check out <a target="_blank" rel="noopener" href="https://the.exa.website/"><code>exa</code></a>.
If, instead, you want to read another blog post from the same series, check out <a href="/2017/yes"><em>A Little Story About the <code>yes</code> Unix Command</em></a>.</p>
<ul class="links">
    <li>💬 Comments available on
            <a target="_blank" rel="noopener" href="https://www.reddit.com/r/rust/comments/83tvpm/a_tiny_ls_clone_written_in_rust/">Reddit</a>
            and
            <a target="_blank" rel="noopener" href="https://twitter.com/matthiasendler/status/972170717663031296">Twitter</a>.
    </li>
</ul>
        </main>
<footer><form style="border:1px solid #ccc;padding:30px;text-align:center;" action="https://tinyletter.com/mre" method="post" target="popupwindow" 
onsubmit="window.open('https://tinyletter.com/mre', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p><label for="tlemail">Subscribe to newsletter <i style="color: #aaa">(one mail per month)</i></label></p>
    <p>
        <input class="field email" type="email" name="email" id="tlemail" placeholder="E-Mail Address"/>
        <input type="hidden" value="1" name="embed"/><input class="field submit" type="submit" value="Subscribe" />
    </p>
    <p>
    💡 I also <a target="_blank" rel="noopener" href="https://twitter.com/matthiasendler">tweet</a> new articles and have an <a target="_blank" rel="noopener" href="https://feedly.com/i/subscription/feed/https://matthias-endler.de/rss.xml">RSS feed</a>.
    </p>
</form>
    <h3>Continue reading</h3>
    <ul>
        
        
            <li><a href="/2018/cargo-inspect">cargo-inspect</a></li>
        
        
        
            <li><a href="/2018/excel">The Unreasonable Effectiveness of Excel Macros</a></li>
        
        
        
            <li><a href="/2018/keyboard">Switching from a German to a US Keyboard Layout - Is It Worth It?</a></li>
        
        
        
            <li><a href="/2018/fastcat">fastcat - A Faster `cat` Implementation Using Splice</a></li>
        
        
        
            <li><a href="/2018/github">That Octocat on the Wall</a></li>
        
        
    </ul>
</footer>

<script type="text/javascript">
if (location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
    window.ga=window.ga||function(){(ga.q = ga.q || []).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-693428-1', 'auto');
    ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
  </body>
</html>
