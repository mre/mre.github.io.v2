<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
    ﻿html,body,div,form,fieldset,legend,label,h1{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0}th,td{text-align:left;vertical-align:top}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:normal}img{border:0;max-width:100%}h1{font-size:1.87em}h2{font-size:1.2em;margin-bottom:10px;margin-top:0}h3{margin-top:50px}body{background-color:#fff;color:rgba(0,0,0,.8);font-family:medium-content-serif-font,Georgia,Cambria,"Times New Roman",Times,serif;-moz-font-feature-settings:"liga" on;font-feature-settings:"liga" on;font-size:1.25em;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;letter-spacing:-0.003em;line-height:1.58;text-rendering:optimizeLegibility}article{margin-top:44px}pre{-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:.92em;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;padding:20px;overflow:auto}::-moz-selection{background:#000;color:#fff}::selection{background:#000;color:#fff}body{margin-top:8%}header{font-size:.78em;margin:0 auto 2em;max-width:220px;text-align:center}a:link,a:visited,a:hover,a:active{color:#af403c;text-decoration:none}a:hover{text-decoration:underline}nav{text-align:center}nav ul{display:inline-block;text-align:initial;padding-left:0}nav li:not(:first-child):before{content:" · "}nav li{list-style:none;display:inline}.logo{background-size:cover;display:inline-block;height:150px;width:171px}.published-date{color:#888;font-size:.8em}blockquote{border-left:4px solid #ededee;font-style:italic;margin:4px 10px;padding:3px 20px}code{background-color:#f9f9fa;border:1px solid #ededee;border-radius:6px;display:inline-block;font-family:"Courier New","Courier",monospace;-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:16px;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;max-width:100%;overflow-x:auto;padding:0 5px;vertical-align:middle;word-wrap:normal;box-shadow:0 1px 1px rgba(0,0,0,.125)}.button{background-color:#af403c;border-radius:10px;color:#fff;margin:40px auto;padding:10px;text-align:center}.button:hover{background-color:red}.talk{margin-top:80px}.video-container{position:relative;padding-bottom:56.25%;padding-top:30px;height:0;overflow:hidden;margin-bottom:40px}.video-container iframe,.video-container object,.video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}figure{font-size:.9em;font-style:italic;margin:0 0 40px;padding:0;text-align:center;text-indent:0}figcaption{margin-top:10px}.loader{position:relative;overflow:hidden;width:auto}.loader object{position:absolute}.loader img,.loader object{display:block;top:0;left:0;width:100%}object{position:relative;float:left;display:block}object::after{position:absolute;top:0;left:0;display:block;width:1000px;height:1000px;content:"";background:#efefef}.frozen{-webkit-filter:blur(8px);-moz-filter:blur(8px);-o-filter:blur(8px);-ms-filter:blur(8px);filter:blur(8px);transform:scale(1.04);animation:.2s ease-in .4s 1 forwards fade;width:100%}@keyframes fade{0%{opacity:1}100%{opacity:0}}@media(max-width: 520px){body{padding:0 20px}pre{font-size:.85em;padding:5px}h1{font-size:1.6em}}@media(min-width: 520px){body{margin:10% auto 0;margin-top:120px;width:480px}h1{font-size:1.6em}}@media(min-width: 1024px){body{width:850px}header{float:left;width:210px}main,footer{margin-left:260px;margin-bottom:40px}}footer{margin-bottom:40px}.links{list-style:none;display:inline}.field{padding:10px;font-size:.8em}.email{width:300px}.submit{border:none;padding:12px;background-color:#eee}

    </style>
    <link rel="dns-prefetch" href="//www.google-analytics.com/" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=m2llJQPQq8">
    <link rel="manifest" href='data:application/manifest+json,
    { "short_name": "Endler",
    "icons": [
        {
            "src": "/android-chrome-192x192.png?v=m2llJQPQq8",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "/android-chrome-512x512.png?v=m2llJQPQq8",
            "sizes": "512x512",
            "type": "image/png"
        }
    ]
    }' />
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=m2llJQPQq8" color="#5bbad5">
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">


<meta property="og:title" content="A Little Story About the `yes` Unix Command" />
<meta property="og:type" content="website" />
<meta property="og:description" content="What&#39;s the simplest Unix command you know?&lt;b..." />
<meta property="og:url" content="https://matthias-endler.de/2017/yes" />
<meta property="og:image" content="https://matthias-endler.de/img/social/default.png" />

<meta name="twitter:title" content="A Little Story About the `yes` Unix Command">
<meta name="twitter:description" content="What&#39;s the simplest Unix command you know?&lt;b...">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://matthias-endler.de/img/social/default.png">

    
      
        <title>A Little Story About the `yes` Unix Command | Matthias Endler</title>
      

    <meta name="author" content="Matthias Endler">
    <meta name="description" content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and backend development. PHP, Python, Go, Rust."/>
  </head>
  <body>
        <header>
            <a class="logo" href="/"><img alt="Home" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3OTAuMjMgNjkyLjYxIj48Y2lyY2xlIGN4PSI0MTMuMjQiIGN5PSIyMjcuNyIgcj0iMjE5LjY4IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTYuMDMiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCIvPjxnIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjYTE2MjAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCI+PHBhdGggZmlsbD0iIzMzMWYwMCIgc3Ryb2tlLXdpZHRoPSIxLjk3IiBkPSJNNDgzLjc1IDI2NS43NGwtNjcuMDcgNDAuMTQtNzQuMjMtMzkuNTMgMTQxLjMtLjZ6IiBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JSIvPjxwYXRoIGZpbGw9IiNlZmJhMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQ4Ni42NSAyNjUuOTJsLTcwLjIgMzQuMDItNzYuOS0zMy45IDE0Ny4xLS4xMnoiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIi8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2OC42NCAyLjkxNCkgc2NhbGUoLjY1Nzk1KSIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIj48ZWxsaXBzZSBjeD0iLTYwOC43NSIgY3k9Ii0xNjMuMTQiIHRyYW5zZm9ybT0ibWF0cml4KDEuMjQ4OTcgLS4xMTM3IC4xMDcgMS4xNzUxNyAxMDk1Ljg3IDQ2Ni43KSIgcng9IjI1LjI1IiByeT0iMjgiLz48ZWxsaXBzZSBjeD0iMzMxLjM2IiBjeT0iMzQ3Ljk5IiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09Im1hdHJpeCguNTIyMTMgMCAwIC41NDc0NSAxNTguNzU3IDEzNi40MzIpIiByeD0iMTUuMTUiIHJ5PSIxNy4wNCIvPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjguNjQgMi45MTQpIHNjYWxlKC42NTc5NSkiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCI+PGVsbGlwc2UgY3g9Ii02MDguNzUiIGN5PSItMTYzLjE0IiB0cmFuc2Zvcm09Im1hdHJpeCgxLjI0ODk3IC0uMTEzNyAuMTA3IDEuMTc1MTcgMTIwMy4yIDQ2Ny42NDYpIiByeD0iMjUuMjUiIHJ5PSIyOCIvPjxlbGxpcHNlIGN4PSIzMzEuMzYiIGN5PSIzNDcuOTkiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0ibWF0cml4KC41MjIxMyAwIDAgLjU0NzQ1IDI2NS4zNTggMTM2Ljk5MykiIHJ4PSIxNS4xNSIgcnk9IjE3LjA0Ii8+PC9nPjxnIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjMDAwIj48cGF0aCBkPSJNMzY2LjQgMTAwLjY0YzE4LjU0LTExLjA1IDM2LjU0LTIyLjU3IDQ2Ljk0LTQwLjczIDEuMzUgMTIuMy0uMSAyOC41LTEwLjg2IDQzLjUiLz48cGF0aCBkPSJNMzg5LjQ0IDEwMC42NGMxOC41NC0xMS4wNSAzNi41NC0yMi41NyA0Ni45NC00MC43MyAxLjM1IDEyLjMtLjEgMjguNS0xMC44NiA0My41Ii8+PHBhdGggZD0iTTQxMi40OCAxMDAuNjRDNDMxLjAyIDg5LjYgNDQ5IDc4LjA3IDQ1OS40MiA1OS45YzEuMzUgMTIuMy0uMSAyOC40NC0xMC44NiA0My40NiIvPjwvZz48cGF0aCBkPSJNNDA5LjI0IDg3LjA1Yy04MS44NS4yNy0xNTYuNDQgMTA0LjQzLTE4MC40OCAyMTYuNDZhMTk5LjYgMTk5LjYgMCAwIDAgNTEuODMgNzMuMWM3LjktMTU3LjkgNDQuNy0yNjYuOSAxMTIuNS0yMDcuOCAxMC4xIDguOSAxNS4yIDEyLjkgMjAuMSAxMi42IDQuOS4zIDEwLTMuOCAyMC4xLTEyLjYgNjcuNy01OS4xIDEwNC42IDUwIDExMi41IDIwNy44YTE5OS42IDE5OS42IDAgMCAwIDUxLjgtNzIuOWMtMjQtMTEyLTk4LjYtMjE2LjMtMTgwLjUtMjE2LjUtMS4zOCAwLTIuNy4xLTQgLjEtMS4zOCAwLTIuNy0uMS00LS4xeiIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZmlsbD0iIzk1OTU5NSIgZD0iTTEzMS4zIDY5Mi42aDExLjRsLTIwLjkyLTEzOC4zSDEwOS41TDg4LjYgNjkyLjZIMTAwbDUuODgtNDUuOGgxOS4zNnptLTI0LjItNTQuOTZsOC40Ni02NC4zIDguNDcgNjQuM3ptODIuMDUtODMuMzRIMTQ4djEwLjczaDE0Ljg3VjY5Mi42aDExLjRWNTY1LjA0aDE0Ljg4eiIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBmb250LWZhbWlseT0iRXZlciBBZnRlciIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCIvPjxwYXRoIGZpbGw9IiM5NTk1OTUiIGQ9Ik0yMjguNjUgNTU0LjNIMTg3LjV2MTAuNzNoMTQuODdWNjkyLjZoMTEuNFY1NjUuMDRoMTQuODh6bTQ0LjkgMHY2MS4zOEgyNDUuMlY1NTQuM2gtMTEuNDJ2MTM4LjNoMTEuNHYtNjYuMzhoMjguMzZ2NjYuNGgxMS4yM1Y1NTQuM3ptMzcuOCAxMzguM2gtMTEuNFY1NTQuM2gxMS40em01Ny42NSAwaDExLjRsLTIwLjkyLTEzOC4zSDM0Ny4ybC0yMC45IDEzOC4zaDExLjRsNS44Ny00NS44aDE5LjM2em0tMjQuMjItNTQuOTZsOC40Ny02NC4zIDguNDcgNjQuM3oiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246J0V2ZXIgQWZ0ZXIsIE5vcm1hbCc7dGV4dC1hbGlnbjpzdGFydCIgZm9udC1mYW1pbHk9IkV2ZXIgQWZ0ZXIiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiLz48cGF0aCBkPSJNNTE3LjI2IDU2NS4wM1Y1NTQuM2gtMzEuNjR2MTM4LjNoMzEuNjR2LTEwLjdoLTIwLjIzdi01NS43aDE4Ljg1di0xMC41NGgtMTguODVWNTY1em0xMS4yNC0xMC43M3YxMzguM2gxMS4zNVY1NTQuM0g1MjguNXptMzkuNzYgMHY1MS44N2wtLjEtLjE3djIwLjc1bC4xLjE3djY1LjdoMTEuMjRWNTU0LjNoLTExLjI0em00MC4yNCAwaC0xMy44djEzOC4zaDEzLjgzcTIyLjMgMCAyOS41Ny0yMi40NiA0LjE1LTEzLjMyIDQuMTUtNDYuNjh0LTQuMTUtNDYuNjdxLTcuMjYtMjIuNS0yOS41Ni0yMi41em0tMS4yIDEyNy42aC0xLjJWNTY1LjAyaDEuMnExNS43MyAwIDIwLjU3IDE4LjUgMy4xIDExLjA2IDMuMSAzOS45MyAwIDI4Ljg3LTMuMSAzOS45My00Ljg0IDE4LjUtMjAuNTcgMTguNXptNjAuMjQgMFY1NTQuM2gtMTEuNHYxMzguM2gzMS42MnYtMTAuN3ptNjIuMS0xMTYuODdWNTU0LjNINjk4djEzOC4zaDMxLjYzdi0xMC43SDcwOS40di01NS43aDE4Ljg1di0xMC41NEg3MDkuNFY1NjV6bTYwLjUgMTI3LjU3cS0xNC4xNy0zNy0yMC43NC03Mi4yNSAxNC4xNy0xMC4zNyAxNC4xNy0zMy44OCAwLTMyLjE2LTI3LjQ4LTMyLjE2aC0xNS4zdjEzOC4zaDExLjR2LTY1cTIuMi0uNSA2LjktMiA3IDMzLjQgMTguMyA2Ny4xem0tMzcuODYtNzguNDd2LTQ5LjFoMi42cTEwLjU0IDAgMTQuNyA1Ljg4IDMuMjcgNC43IDMuMjcgMTUuNiAwIDE1LjgtOC4xMiAyMy40LTUuMiA0LjktMTAuMiA0LjktMS4zOCAwLTIuMjUtLjV6IiBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOidFdmVyIEFmdGVyLCBOb3JtYWwnO3RleHQtYWxpZ246c3RhcnQiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEwIiBkPSJNNTM1LjA2IDU1NS43MmwzOCAxMzUuNTQiLz48cGF0aCBmaWxsPSIjOTU5NTk1IiBkPSJNLjEgNTU0LjZ2MTM4aDExLjM4VjU3NS42NWM2LjYgMTIuNyAxMy43OCAyNS45IDE5LjY3IDM2Ljc4bDUuNyAxMCAuMDItLjAydi4xbDUuNzItMTBjNi41LTEyIDEzLjUtMjUuMiAxOS43LTM2Ljh2MTE2LjloMTEuMnYtMTM4SDYyLjNDNTUgNTY4IDQ3LjUgNTgyIDQwLjggNTk0LjRsLTQgNy40NWMtOS4xLTE3LjA1LTE3LjMtMzIuMDctMjUuNC00Ny4yM3oiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246J0V2ZXIgQWZ0ZXIsIE5vcm1hbCc7dGV4dC1hbGlnbjpzdGFydCIgZm9udC1zaXplPSIxNzIuNTIiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZmlsbD0iIzk1OTU5NSIgZD0iTTM5OC44NCA2OTEuNjZjLTMuNzItMS4zMy04Ljk2LTUtMTEuNzYtOC4yLTEuNC0xLjYtMi41LTMuMjUtMi41NC0zLjYgNC4yMy02LjA1IDQuNDItNi4zMiA1LjMtNy40NSAzLjMgMy40IDYuNyA2LjggMTAuOSA5LjEgNC45OCAxLjggMTEuMjQgMi4xIDE1LjMyLS4zIDUuNTItMy4zIDguNjItOC44IDkuNjctMTcuMyAxLjQ2LTExLjctMi42NS0yMi41LTEzLjI1LTM0LjgtMi45LTMuNC03LjEzLTguMy05LjM4LTEwLjktNC44Ni01LjYtMTAtMTMuNC0xMS43Ny0xOC41LTQuMy0xMi41LTMuODctMjEuMy0uNjYtMzAuMiAyLjEyLTUuODMgNC45LTkuNiA5LjA4LTEyLjIgOC4yNi01LjE0IDE5LjI4LTQuMjQgMjcuMzYgMi4yNS45LjY4IDEuNyAxLjQ0IDIuNSAyLjU3LS40Ljc3LTMuNyA4Ljc3LTQuMyA4Ljc3LS44LS42Ni0uOC0uNi0xLjYtMS4zLS43LS43LTIuNy0yLjEtNC40LTMuMTQtNC40LTIuMS04LjUtMy4xLTEyLjktLjctNi4xIDMuNDQtOS4yIDExLjctNy45IDIxLjQgMS4xIDguMzQgNC41IDE0IDE3LjkgMjkuNSAxMy4wOCAxNS4yIDE2Ljk1IDIyLjMgMTguOSAzNC42My45IDUuNy45IDEwLjA0IDAgMTYuNi0xLjY1IDEyLjMzLTcuMiAyMC41LTE2LjIgMjMuOTYtMy4zIDEuMy0xNi40NSAxLjMtMjAuMDMuMDR6Ii8+PC9zdmc+" />
            </a>
            <p>
              Backend Engineer at trivago. Likes just-in-time compilers and hot chocolate. <a href="/about">About me.</a>
            </p>
            <nav>
              <ul>
                <li><a href="/">Home</a></li>
                <li><a target="_blank" rel="noopener" href="https://twitter.com/matthiasendler">Twitter</a></li>
                <li><a target="_blank" rel="noopener" href="https://feedly.com/i/subscription/feed/https://matthias-endler.de/rss.xml">RSS</a></li>
              </ul>
            </nav>
        </header>
        <main role="main">
            
              <div class="published-date">
                <i>Published on 10th of October 2017</i>
              </div>
            
              <h1>A Little Story About the `yes` Unix Command</h1>
            <p>What's the simplest Unix command you know?<br />
There's <code>echo</code>, which prints a string to stdout and <code>true</code>, which always terminates with an exit code of 0.</p>
<p>Among the rows of simple Unix commands, there's also <code>yes</code>.
If you run it without arguments, you get an infinite stream of y's, separated by a newline:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">(...you get the idea)
</span></pre>
<p>What seems to be pointless in the beginning turns out to be pretty helpful  :</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">yes | sh boring_installation.sh
</span></pre>
<p>Ever installed a program, which required you to type &quot;y&quot; and hit enter to keep going?
<code>yes</code> to the rescue! It will carefully fulfill this duty, so you can keep watching <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=yhBExhldRXQ">Pootie Tang</a>.</p>
<h3>Writing yes</h3>
<p>Here's a basic version in... uhm... BASIC.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">10 PRINT &quot;y&quot;
</span><span style="background-color:#eff1f5;color:#4f5b66;">20 GOTO 10
</span></pre>
<p>And here's the same thing in Python:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">True</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#96b5b4;">print</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Simple, eh? Not so quick!<br />
Turns out, that program is quite slow.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">python yes.py | pv -r &gt; /dev/null
</span><span style="background-color:#eff1f5;color:#4f5b66;">[4.17MiB/s]
</span></pre>
<p>Compare that with the built-in version on my Mac:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">yes | pv -r &gt; /dev/null
</span><span style="background-color:#eff1f5;color:#4f5b66;">[34.2MiB/s]
</span></pre>
<p>So I tried to write a quicker version in Rust. Here's my first attempt:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">env</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">env::</span><span style="background-color:#eff1f5;color:#4f5b66;">args</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">nth</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">unwrap_or</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">into</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">loop</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Some explanations:</p>
<ul>
<li>The string we want to print in a loop is the first command line parameter and is named <em>expletive</em>. I learned this word from the <code>yes</code> manpage.</li>
<li>I use <code>unwrap_or</code> to get the <em>expletive</em> from the parameters. In case the parameter is not set, we use &quot;y&quot; as a default.</li>
<li>The default parameter gets converted from a string slice (<code>&amp;str</code>) into an <em>owned</em> string on the heap (<code>String</code>) using <code>into()</code>.</li>
</ul>
<p>Let's test it.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">cargo run --release | pv -r &gt; /dev/null
</span><span style="background-color:#eff1f5;color:#4f5b66;">   </span><span style="background-color:#eff1f5;color:#4f5b66;">Compiling yes v0.1.0
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Finished release [optimized] target(s) in 1.0 secs
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">Running `target/release/yes`
</span><span style="background-color:#eff1f5;color:#4f5b66;">[2.35MiB/s] 
</span></pre>
<p>Whoops, that doesn't look any better. It's even slower than the Python version!
That caught my attention, so I looked around for the source code of a C implementation.</p>
<p>Here's the <a target="_blank" rel="noopener" href="https://github.com/dspinellis/unix-history-repo/blob/4c37048d6dd7b8f65481c8c86ef8cede2e782bb3/usr/src/cmd/yes.c">very first version of the program</a>, released with Version 7 Unix and famously authored by Ken Thompson on <nobr>Jan 10, 1979</nobr>:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#bf616a;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">argc</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> argv</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">char</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;">argv</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">for</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#96b5b4;">printf</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">%s</span><span style="background-color:#eff1f5;color:#96b5b4;">\n</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> argc</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;"> argv</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>No magic here.</p>
<p>Compare that to the <a target="_blank" rel="noopener" href="https://github.com/coreutils/coreutils/blame/master/src/yes.c">128-line-version from the GNU coreutils, which is mirrored on Github</a>. After 25 years, <em>it is still under active development!</em>
The last code change happened around a <a target="_blank" rel="noopener" href="https://github.com/coreutils/coreutils/commit/4cdb1703aff044de44d27e0558714542197f6dad">year ago</a>.
That's quite fast:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;"># brew install coreutils
</span><span style="background-color:#eff1f5;color:#4f5b66;">gyes | pv -r &gt; /dev/null 
</span><span style="background-color:#eff1f5;color:#4f5b66;">[854MiB/s]
</span></pre>
<p>The important part is at the end:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#a7adba;">/*</span><span style="background-color:#eff1f5;color:#a7adba;"> Repeatedly output the buffer until there is a write error; then fail.  </span><span style="background-color:#eff1f5;color:#a7adba;">*/</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">full_write</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">STDOUT_FILENO</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> buf</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> bufused</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">==</span><span style="background-color:#eff1f5;color:#4f5b66;"> bufused</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">continue</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Aha! So they simply use a buffer to make write operations faster.
The buffer size is defined by a constant named <code>BUFSIZ</code>, which gets chosen on each system so as to make I/O efficient (see <a target="_blank" rel="noopener" href="https://www.gnu.org/software/libc/manual/html_node/Controlling-Buffering.html">here</a>).
On my system, that was defined as 1024 bytes. I actually had better performance with 8192 bytes.</p>
<p>I've extended my Rust program:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">env</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> BufWriter</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Write</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">const</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">BUFSIZE</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">usize</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">8192</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">env::</span><span style="background-color:#eff1f5;color:#4f5b66;">args</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">nth</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">unwrap_or</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">into</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> writer </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">BufWriter::</span><span style="background-color:#eff1f5;color:#4f5b66;">with_capacity</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">BUFSIZE</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">stdout</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">loop</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">writeln!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">writer,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">unwrap</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>The important part is, that the buffer size is a multiple of four, to ensure <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/381368/270334">memory alignment</a>.</p>
<p>Running that gave me 51.3MiB/s.
Faster than the version, which comes with my system, but still way slower than the results from <a target="_blank" rel="noopener" href="https://www.reddit.com/r/unix/comments/6gxduc/how_is_gnu_yes_so_fast/">this Reddit post</a> that I found, where the author talks about 10.2GiB/s.</p>
<h3>Update</h3>
<p>Once again, the Rust community did not disappoint.<br />
As soon as this post <a target="_blank" rel="noopener" href="https://www.reddit.com/r/rust/comments/75fll1/a_little_story_about_the_yes_unix_command/">hit the Rust subreddit</a>, user <a target="_blank" rel="noopener" href="https://www.reddit.com/user/nwydo">nwydo</a> pointed out a <a target="_blank" rel="noopener" href="https://www.reddit.com/r/rust/comments/4wde08/optimising_yes_any_further_ideas/">previous discussion</a> on the same topic.
Here's their optimized code, that breaks the 3GB/s mark on my machine:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">env</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Write</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">process</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">borrow::</span><span style="background-color:#eff1f5;color:#4f5b66;">Cow</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">ffi::</span><span style="background-color:#eff1f5;color:#4f5b66;">OsString</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">pub</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">const</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">BUFFER_CAPACITY</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">usize</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">64</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">1024</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">pub</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">to_bytes</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">os_str</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> OsString</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Vec</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">os::</span><span style="background-color:#eff1f5;color:#4f5b66;">unix::</span><span style="background-color:#eff1f5;color:#4f5b66;">ffi::</span><span style="background-color:#eff1f5;color:#4f5b66;">OsStringExt</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">os_str.</span><span style="background-color:#eff1f5;color:#96b5b4;">into_vec</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">fill_up_buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> [</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">], </span><span style="background-color:#eff1f5;color:#bf616a;">output</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> [</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">if</span><span style="background-color:#eff1f5;color:#4f5b66;"> output.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">/</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">2</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">return</span><span style="background-color:#eff1f5;color:#4f5b66;"> output</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer_size </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> output.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">clone_from_slice</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">output</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer_size </span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">/</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">2</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> right</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer.</span><span style="background-color:#eff1f5;color:#96b5b4;">split_at_mut</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">clone_from_slice</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size </span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">2</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">write</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">output</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> stdout </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">stdout</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> locked </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> stdout.</span><span style="background-color:#eff1f5;color:#96b5b4;">lock</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">BUFFER_CAPACITY</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> filled </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">fill_up_buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> output</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> locked.</span><span style="background-color:#eff1f5;color:#96b5b4;">write_all</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">filled</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">is_ok</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#96b5b4;">write</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">env::</span><span style="background-color:#eff1f5;color:#4f5b66;">args_os</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">nth</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">map</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">to_bytes</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">map_or</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Cow::</span><span style="background-color:#eff1f5;color:#4f5b66;">Borrowed</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">b</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#96b5b4;">\n</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">arg</span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">arg.</span><span style="background-color:#eff1f5;color:#96b5b4;">push</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#b48ead;">b</span><span style="background-color:#eff1f5;color:#4f5b66;">&#39;</span><span style="background-color:#eff1f5;color:#96b5b4;">\n</span><span style="background-color:#eff1f5;color:#4f5b66;">&#39;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">Cow::</span><span style="background-color:#eff1f5;color:#4f5b66;">Owned</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">arg</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">process::</span><span style="background-color:#eff1f5;color:#4f5b66;">exit</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Now that's a whole different ballgame!</p>
<ul>
<li>We prepare a filled string buffer, which will be reused for each loop.</li>
<li><a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/io/struct.Stdout.html#method.lock">Stdout is protected by a lock</a>. So, instead of constantly acquiring and releasing it, we keep it all the time.</li>
<li>We use a the platform-native <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/ffi/struct.OsString.html"><code>std::ffi::OsString</code></a> and <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/borrow/enum.Cow.html"><code>std::borrow::Cow</code></a> to avoid unnecessary allocations.</li>
</ul>
<p>The only thing that I could contribute was <a target="_blank" rel="noopener" href="https://github.com/cgati/yes/pull/3/files">removing an unnecessary <code>mut</code></a>. 😅</p>
<h3>Lessons learned</h3>
<p>The trivial program <code>yes</code> turns out not to be so trivial after all.
It uses output buffering and memory alignment to improve performance.
Re-implementing Unix tools is fun and makes me appreciate the nifty tricks,
which make our computers fast.</p>
<ul class="links">
    <li>💬 Comments available on
            <a target="_blank" rel="noopener" href="https://www.reddit.com/r/rust/comments/75fll1/a_little_story_about_the_yes_unix_command/">Reddit</a>
            and
            <a target="_blank" rel="noopener" href="https://news.ycombinator.com/item?id=15454352">Hacker News</a>.
    </li>
    <li>📖 Translated into
            <a target="_blank" rel="noopener" href="http://postd.cc/a-little-story-about-the-yes-unix-command/">Japanese</a>.
    </li>
</ul>
        </main>
<footer><form style="border:1px solid #ccc;padding:30px;text-align:center;" action="https://tinyletter.com/mre" method="post" target="popupwindow" 
onsubmit="window.open('https://tinyletter.com/mre', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p><label for="tlemail">Subscribe to newsletter <i style="color: #aaa">(one mail per month)</i></label></p>
    <p>
        <input class="field email" type="email" name="email" id="tlemail" placeholder="E-Mail Address"/>
        <input type="hidden" value="1" name="embed"/><input class="field submit" type="submit" value="Subscribe" />
    </p>
    <p>
    💡 I also <a target="_blank" rel="noopener" href="https://twitter.com/matthiasendler">tweet</a> new articles and have an <a target="_blank" rel="noopener" href="https://feedly.com/i/subscription/feed/https://matthias-endler.de/rss.xml">RSS feed</a>.
    </p>
</form>
    <h3>Continue reading</h3>
    <ul>
        
        
            <li><a href="/2018/cargo-inspect">cargo-inspect</a></li>
        
        
        
            <li><a href="/2018/excel">The Unreasonable Effectiveness of Excel Macros</a></li>
        
        
        
            <li><a href="/2018/keyboard">Switching from a German to a US Keyboard Layout - Is It Worth It?</a></li>
        
        
        
            <li><a href="/2018/fastcat">fastcat - A Faster `cat` Implementation Using Splice</a></li>
        
        
        
            <li><a href="/2018/github">That Octocat on the Wall</a></li>
        
        
    </ul>
</footer>

<script type="text/javascript">
if (location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
    window.ga=window.ga||function(){(ga.q = ga.q || []).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-693428-1', 'auto');
    ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
  </body>
</html>
